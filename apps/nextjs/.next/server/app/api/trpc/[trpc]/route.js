(()=>{var e={};e.id=3841,e.ids=[3841],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{"use strict";e.exports=require("node:buffer")},5613:(e,t,r)=>{"use strict";e.exports=r(44870)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14985:e=>{"use strict";e.exports=require("dns")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37067:e=>{"use strict";e.exports=require("node:http")},41204:e=>{"use strict";e.exports=require("string_decoder")},44708:e=>{"use strict";e.exports=require("node:https")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},50941:()=>{},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57075:e=>{"use strict";e.exports=require("node:stream")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66480:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>q,routeModule:()=>h,serverHooks:()=>w,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>g,OPTIONS:()=>p,POST:()=>g});var i=r(5613),o=r(31450),n=r(45945),a=r(53987);r(24181),r(67842),r(68994);let u=e=>e=(e=e.startsWith("/")?e.slice(1):e).endsWith("/")?e.slice(0,-1):e;async function c(e){let t=new Headers,r=async r=>e.createContext?.({req:e.req,resHeaders:t,...r}),s=u(new URL(e.req.url).pathname),i=u(e.endpoint),o=u(s.slice(i.length));return await (0,a.S)({...e,req:e.req,createContext:r,path:o,error:null,onError(t){e?.onError?.({...t,req:e.req})},responseMeta(r){let s=e.responseMeta?.(r);if(s?.headers){if(s.headers instanceof Headers)for(let[e,r]of s.headers.entries())t.append(e,r);else for(let[e,r]of Object.entries(s.headers))if(Array.isArray(r))for(let s of r)t.append(e,s);else"string"==typeof r&&t.set(e,r)}return{headers:t,status:s?.status}}})}var d=r(70998);let l=e=>{e.headers.set("Access-Control-Allow-Origin","*"),e.headers.set("Access-Control-Request-Method","*"),e.headers.set("Access-Control-Allow-Methods","OPTIONS, GET, POST"),e.headers.set("Access-Control-Allow-Headers","*")},p=()=>{let e=new Response(null,{status:204});return l(e),e},g=async e=>{let t=await c({endpoint:"/api/trpc",router:d.PJ,req:e,createContext:()=>(0,d.dW)({headers:e.headers}),onError({error:e,path:t}){console.error(`>>> tRPC Error on '${t}'`,e)}});return l(t),t},h=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/trpc/[trpc]/route",pathname:"/api/trpc/[trpc]",filename:"route",bundlePath:"app/api/trpc/[trpc]/route"},resolvedPagePath:"/Users/andreicruceru/partnership-tool/apps/nextjs/src/app/api/trpc/[trpc]/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:m,serverHooks:w}=h;function q(){return(0,n.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:m})}},70998:(e,t,r)=>{"use strict";r.d(t,{PJ:()=>f,dW:()=>u});var s=r(83304),i=r(91082),o=r(5162),n=r(48346),a=r(76880);let u=async e=>({session:await n.j2.api.getSession({headers:e.headers}),db:a.db,ip:e.headers.get("x-forwarded-for")}),c=s.Al.context().create({transformer:i.Ay,errorFormatter:({shape:e,error:t})=>({...e,data:{...e.data,zodError:t.cause instanceof o.G?t.cause.flatten():null}})}),d=c.createCallerFactory,l=c.router,p=c.middleware(async({next:e,path:t})=>{let r=Date.now();if(c._config.isDev){let e=Math.floor(400*Math.random())+100;await new Promise(t=>setTimeout(t,e))}let s=await e(),i=Date.now();return console.log(`[TRPC] ${t} took ${i-r}ms to execute`),s}),g=c.procedure.use(p),h=c.procedure.use(p).use(({ctx:e,next:t})=>{if(!e.session?.user)throw new s.gt({code:"UNAUTHORIZED"});return t({ctx:{session:{...e.session,user:e.session.user}}})}),y={getSession:g.query(({ctx:e})=>e.session),getSecretMessage:h.query(()=>"you can see this secret message!")};var m=r(8731),w=r(71464);let q={getAll:g.query(async({ctx:e})=>await e.db.query.blogPost.findMany({where:(0,m.eq)(w.blogPost.published,!0),orderBy:[(0,m.i8)(w.blogPost.createdAt)],with:{author:{columns:{id:!0,name:!0,image:!0}}}})),debug:g.query(async({ctx:e})=>{let t=await e.db.query.blogPost.findMany({orderBy:[(0,m.i8)(w.blogPost.createdAt)],with:{author:{columns:{id:!0,name:!0,image:!0}}}});return console.log("Debug: Found posts:",t.length),console.log("Debug: Posts data:",JSON.stringify(t,null,2)),t}),getAllForNick:h.query(async({ctx:e})=>{let t=await e.db.query.userAnalysis.findFirst({where:(0,m.eq)(w.userAnalysis.userId,e.session.user.id)});if(!t?.isNick)throw Error("Unauthorized: Only Nick can access all posts");return await e.db.query.blogPost.findMany({orderBy:[(0,m.i8)(w.blogPost.createdAt)],with:{author:{columns:{id:!0,name:!0,image:!0}}}})}),create:h.input(o.z.object({title:o.z.string().min(1).max(255),content:o.z.string().min(1),images:o.z.array(o.z.string().url()).optional(),published:o.z.boolean().default(!1)})).mutation(async({ctx:e,input:t})=>{let r=await e.db.query.userAnalysis.findFirst({where:(0,m.eq)(w.userAnalysis.userId,e.session.user.id)});if(!r?.isNick)throw Error("Unauthorized: Only Nick can create blog posts");return(await e.db.insert(w.blogPost).values({id:crypto.randomUUID(),title:t.title,content:t.content,images:t.images||[],authorId:e.session.user.id,published:t.published,createdAt:new Date,updatedAt:new Date}).returning())[0]}),update:h.input(o.z.object({id:o.z.string(),title:o.z.string().min(1).max(255).optional(),content:o.z.string().min(1).optional(),images:o.z.array(o.z.string().url()).optional(),published:o.z.boolean().optional()})).mutation(async({ctx:e,input:t})=>{let r=await e.db.query.userAnalysis.findFirst({where:(0,m.eq)(w.userAnalysis.userId,e.session.user.id)});if(!r?.isNick)throw Error("Unauthorized: Only Nick can update blog posts");return(await e.db.update(w.blogPost).set({...t.title&&{title:t.title},...t.content&&{content:t.content},...t.images&&{images:t.images},...void 0!==t.published&&{published:t.published},updatedAt:new Date}).where((0,m.eq)(w.blogPost.id,t.id)).returning())[0]}),delete:h.input(o.z.object({id:o.z.string()})).mutation(async({ctx:e,input:t})=>{let r=await e.db.query.userAnalysis.findFirst({where:(0,m.eq)(w.userAnalysis.userId,e.session.user.id)});if(!r?.isNick)throw Error("Unauthorized: Only Nick can delete blog posts");return await e.db.delete(w.blogPost).where((0,m.eq)(w.blogPost.id,t.id)),{success:!0}}),isNick:h.query(async({ctx:e})=>{let t=await e.db.query.userAnalysis.findFirst({where:(0,m.eq)(w.userAnalysis.userId,e.session.user.id)});return{isNick:t?.isNick??!1}})},b=o.z.object({email:o.z.string().email(),role:o.z.enum(["admin","member","guest"]).default("member")}),f=l({auth:y,blog:q,organization:{subscription:h.query(async({ctx:e})=>{let{session:t}=e;if(!t.session.activeOrganizationId)throw new s.gt({code:"UNAUTHORIZED",message:"No active organization"});return await e.db.query.subscription.findFirst({where:(0,m.eq)(w.subscription.referenceId,t.session.activeOrganizationId)})??null}),inviteMember:h.input(b).mutation(async({ctx:e,input:t})=>{let{session:r}=e;if(!r.session.activeOrganizationId)throw new s.gt({code:"UNAUTHORIZED",message:"No active organization"});Math.random().toString(36).substring(2,15);try{return{success:!0,email:t.email,message:`Invitation sent to ${t.email}`}}catch(e){throw console.error("Failed to invite member:",e),new s.gt({code:"INTERNAL_SERVER_ERROR",message:"Failed to send invitation",cause:e})}})}});d(f)},77598:e=>{"use strict";e.exports=require("node:crypto")},78474:e=>{"use strict";e.exports=require("node:events")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},84297:e=>{"use strict";e.exports=require("async_hooks")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},94909:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1597,6901,8763,5741,8237],()=>r(66480));module.exports=s})();